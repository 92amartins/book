box: rocker/verse
build:
  steps:
    - script:
        name: Fixes
        code: |
          echo "CXXFLAGS=`R CMD config CXXFLAGS` -Wno-ignored-attributes" > ~/.R/Makevars
    - script:
        name: Update Libraries
        code: |
          apt-get update -q
          apt-get install -y jags
          install2.r rjags bookdown BAS latex2exp BHH2
    - script:
        name: Install statsr
        code: |
          Rscript -e "devtools::install_github('statswithr/statsr@BayesFactor')"
    - script:
        name: Render Book (html)
        code: |
          Rscript -e "bookdown::render_book('index.Rmd', 'bookdown::gitbook')"
    - script:
        name: Render Book (pdf)
        code: |
          Rscript -e "bookdown::render_book('index.Rmd', 'bookdown::pdf_book')"
    - script:
        name: Publish book
        code: |
          echo ${ID_RSA} > ~/.ssh/id_rsa
          git config --global user.name "Colin Rundel (Wercker)"
          git config --global user.email "rundel@gmail.com"
          git clone -b gh-pages git@github.com:StatsWithR/book.git book-output
          cd book-output
          cp -r ../_book/* ./
          git add .
          git commit -a -m "Updating book"
          git push -q origin gh-pages
